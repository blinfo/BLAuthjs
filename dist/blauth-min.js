(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else if(typeof module==="object"&&module.exports){module.exports=t()}else{e.BLAuth=t()}})(typeof self!=="undefined"?self:this,function(){"use strict";var s=typeof window=="object"&&window.window===window&&window;if(!s){throw new Error("BLAuth needs the window as global context")}function n(e){var t=s.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}function d(e,t,n){var o="";if(n){var i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3);o="; expires="+i.toUTCString()}s.document.cookie=e+"="+(t||"")+o+"; path=/"}function c(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=n.exec(t);if(!o)return null;if(!o[2])return"";return decodeURIComponent(o[2].replace(/\+/g," "))}var e={};var u,f,p,m;e.init=function(e){var t,n;var o=encodeURI(e.clientId);var l=encodeURI(e.redirectURI);var i="USER_IDENTITY";if(e.scopes&&e.scopes.length!==0){i=encodeURI(e.scopes.join(" "))}var r=e.returnURL||"";r=encodeURI(r);u=e.width||500;f=e.height||700;var a=e.env?e.env:"";p="https://apigateway.blinfo.se/sso"+a+"/authz?"+"redirect_uri="+l+"&client_id="+o+"&scope="+i+"&returnUrl="+r;s.addEventListener("message",function(e){if(e.origin===l.split("/").slice(0,3).join("/")){var t=e.data;if(t.jwt){var n=t.jwt;var o=n.split(".")[1];var i=o.replace("-","+").replace("_","/");var r=JSON.parse(window.atob(i));d("blauth_loggedin","true",1);if(m){m({name:r.name,firstName:r.firstname,lastName:r.lastname,email:r.email,username:r.username,authToken:n})}var a=s.document.getElementById("blauthframe");if(a){a.parentNode.removeChild(a)}}}});if(s.opener!=null&&!s.opener.closed){t=s.location.href;n=c("jwt");s.opener.postMessage({jwt:n},t.split("?")[0]);s.close()}if(s.top!=null&&!s.top.closed){t=s.location.href;n=c("jwt");if(n){s.top.postMessage({jwt:n},t.split("?")[0])}}};e.getLoginStatus=function(e){m=e;if(n("blauth_loggedin")){var t=s.document.createElement("iframe");t.setAttribute("id","blauthframe");t.style.display="none";t.src=p;s.document.body.appendChild(t)}};e.login=function(e){m=e;s.open(p,"Björn Lundén Information AB - webbinlogg","width="+u+",height="+f)};e.logout=function(e){d("blauth_loggedin","",1);e.call()};return e});