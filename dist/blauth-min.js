(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else if(typeof module==="object"&&module.exports){module.exports=t()}else{e.BLAuth=t()}})(typeof self!=="undefined"?self:this,function(){"use strict";var l=typeof window=="object"&&window.window===window&&window;if(!l){throw new Error("BLAuth needs the window as global context")}var o,s,r,a,d,u,f,c;function n(e){var t=l.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""}function p(e,t,n){var i="";if(n){var o=new Date;o.setTime(o.getTime()+n*24*60*60*1e3);i="; expires="+o.toUTCString()}l.document.cookie=e+"="+(t||"")+i+"; path=/"}function m(e,t){if(!t)t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=n.exec(t);if(!i)return null;if(!i[2])return"";return decodeURIComponent(i[2].replace(/\+/g," "))}var e={};e.init=function(e){var t,n;o=e.clientId;s=e.redirectURI;r=e.scope||"";a=e.returnURL||"";d=e.width||500;u=e.height||700;var i=e.env?e.env:"";f="https://apigateway.blinfo.se/sso"+i+"/authz?"+"redirect_uri="+s+"&client_id="+o+"&scope="+r+"&returnUrl="+a;l.addEventListener("message",function(e){if(e.origin===s.split("/").slice(0,3).join("/")){var t=e.data;if(t.jwt){var n=t.jwt;var i=n.split(".")[1];var o=i.replace("-","+").replace("_","/");var r=JSON.parse(window.atob(o));p("blauth_loggedin","true",1);if(c){c({name:r.name,firstName:r.firstname,lastName:r.lastname,email:r.email,username:r.username,authToken:n})}var a=l.document.getElementById("blauthframe");if(a){a.parentNode.removeChild(a)}}}});if(l.opener!=null&&!l.opener.closed){t=l.location.href;n=m("jwt");l.opener.postMessage({jwt:n},t.split("?")[0]);l.close()}if(l.top!=null&&!l.top.closed){t=l.location.href;n=m("jwt");if(n){l.top.postMessage({jwt:n},t.split("?")[0])}}};e.getLoginStatus=function(e){c=e;if(n("blauth_loggedin")){var t=l.document.createElement("iframe");t.setAttribute("id","blauthframe");t.style.display="none";t.src=f;l.document.body.appendChild(t)}};e.login=function(e){c=e;l.open(f,"Björn Lundén Information AB - webbinlogg","width="+d+",height="+u)};e.logout=function(e){p("blauth_loggedin","",1);e.call()};return e});